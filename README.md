# Language Detection with Lingua (Rust) and Go

## Overview
This project demonstrates how to use the [Lingua](https://github.com/pemistahl/lingua-rs) language detection library (written in Rust) from Go code using CGO (C Go). It provides a high-performance, extensible, and accurate language detection solution for Go applications by leveraging Rust's mature Lingua library.

---

## How It Works

### Architecture
- **Rust FFI Library** (`src/lib.rs`): Wraps Lingua's detection functions in a C-compatible interface using `#[no_mangle] extern "C"`.
- **C Header** (`lingua_ffi.h`): Generated by [cbindgen](https://github.com/mozilla/cbindgen), describes the Rust FFI for CGO.
- **Go CGO Interface** (`lingua.go`): Uses `import "C"` to call Rust functions as if they were C functions.
- **Build System**: Uses Cargo for Rust, Go modules for Go, and a Makefile to orchestrate builds.

**Flow:**
1. Go code calls a function (e.g., `DetectLanguage`) via CGO.
2. CGO calls the Rust FFI function in the compiled shared library.
3. Rust code uses Lingua to detect the language and returns the result to Go.

---

## Project Structure
```
language-detection-go/
├── src/lib.rs              # Rust FFI library wrapping Lingua
├── lingua.go               # Go code using CGO to call Rust functions
├── lingua_test.go          # Go tests (including SEA and mixed language cases)
├── Cargo.toml              # Rust dependencies
├── go.mod                  # Go dependencies
├── Makefile                # Build automation
├── build.rs                # Rust build script for cbindgen
├── cbindgen.toml           # cbindgen config for C header
├── README.md               # This documentation
└── target/release/         # Compiled Rust library and header
```

---

## Building and Running

### Prerequisites
- Go 1.21+
- Rust (with Cargo)
- cbindgen (`cargo install cbindgen`)
- A C compiler (gcc/clang)

### Build Steps
```sh
# 1. Build the Rust library and header
cargo build --release
cbindgen --config cbindgen.toml --crate lingua-ffi --output target/release/lingua_ffi.h

# 2. Build the Go application
go build -o lingua-detector lingua.go

# 3. Run the Go application
./lingua-detector

# Or use the Makefile for all steps:
make build
make test
```

### Running Tests
```sh
go test -v
```

---

## Adding More Languages
1. **Edit `src/lib.rs`:**
   - Add more `Language::Xxx,` entries to the `languages` vector in both FFI functions.
   - See [Lingua's supported languages](https://github.com/pemistahl/lingua-rs#supported-languages).
2. **Rebuild:**
   ```sh
   cargo build --release
   cbindgen --config cbindgen.toml --crate lingua-ffi --output target/release/lingua_ffi.h
   go build -o lingua-detector lingua.go
   ```

---

## Adding More Tests
1. **Edit `lingua_test.go`:**
   - Add new test cases to the appropriate test functions or create new ones.
   - For SEA or mixed-language input, see the provided examples.
2. **Run tests:**
   ```sh
   go test -v
   ```

---

## Artifacts for Further Development
- **Rust FFI Layer (`src/lib.rs`):** Extend with more functions or richer return types as needed.
- **Go Wrapper (`lingua.go`):** Add more Go-side helpers, error handling, or concurrency support.
- **Tests (`lingua_test.go`):** Expand with more languages, edge cases, or performance benchmarks.
- **Makefile:** Add targets for linting, cleaning, or packaging.
- **Documentation:** Keep this README up to date as you add features.

### Adding New FFI Functions
- Add a new `#[no_mangle] extern "C" fn ...` in Rust.
- Regenerate the header with cbindgen.
- Add a Go wrapper method using `import "C"`.

### Example: Adding a Function to List Supported Languages
1. In `src/lib.rs`:
   ```rust
   #[no_mangle]
   pub extern "C" fn supported_languages() -> *mut c_char {
       let langs = vec!["English", "Spanish", ...];
       CString::new(langs.join(",")).unwrap().into_raw()
   }
   ```
2. Regenerate the header and add a Go wrapper.

---

## Troubleshooting
- **Header not found:** Ensure `lingua_ffi.h` is in `target/release/` and matches the built library.
- **Linker errors:** Check that `liblingua_ffi.dylib` (macOS) or `.so` (Linux) is in `target/release/`.
- **Test failures:** Some short or ambiguous phrases may be misclassified; try longer or more distinctive sentences.
- **CGO errors:** Ensure all build steps are run from the project root and environment variables are set (e.g., `source $HOME/.cargo/env`).

---

## Contributing
1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add/expand tests
5. Submit a pull request

---

## License
MIT
